<!DOCTYPE html>
<html lang="en">
<head>
    <title>three.js webgl - interactive cubes (gpu)</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        body {
            font-family: Monospace, serif;
            background-color: #f0f0f0;
            margin: 0;
            overflow: hidden;
        }

        .info {
            position: absolute;
            background-color: black;
            opacity: 0.8;
            color: white;
            text-align: center;
            top: 0;
            width: 100%;
        }

        .info a {
            color: #00ffff;
        }
    </style>
</head>
<body>

<div class="info">
    <a href="http://threejs.org" target="_blank">three.js</a> webgl - gpu picking
</div>

<div id="container"></div>

<script src="js/three.js"></script>
<script src="js/TrackballControls.js"></script>
<script src="js/stats.min.js"></script>

<script>

var stats;
var camera, controls, scene, renderer;

var mouse = new THREE.Vector2();
var offset = new THREE.Vector3(10, 10, 10);

init();
animate();

function init() {
    var container = document.getElementById("container");

    camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 1, 10000);
    camera.position.z = 8000;

    controls = new THREE.TrackballControls(camera);
    controls.rotateSpeed = 1.0;
    controls.zoomSpeed = 1.2;
    controls.panSpeed = 0.8;
    controls.noZoom = false;
    controls.noPan = false;
    controls.staticMoving = true;
    controls.dynamicDampingFactor = 0.3;

    scene = new THREE.Scene();

    scene.add(new THREE.AmbientLight(0x555555));

    var light = new THREE.SpotLight(0xffffff, 1.5);
    light.position.set(0, 500, 2000);
    scene.add(light);

    var defaultMaterial = new THREE.MeshLambertMaterial({ color: 0xffffff, shading: THREE.FlatShading, vertexColors: THREE.VertexColors });

    function applyVertexColors(geometry, cube) {
        geometry.faces.forEach(function(f) {
            var n = ( f instanceof THREE.Face3 ) ? 3 : 4;
            for (var j = 0; j < n; j++) {
                f.vertexColors[ j ] = cube;
            }
        });
    }

    for (var i = 0; i < 5000; i++) {
        var position = new THREE.Vector3();
        position.x = Math.random() * 10000 - 5000;
        position.y = Math.random() * 6000 - 3000;
        position.z = Math.random() * 8000 - 4000;

//        var rotation = new THREE.Euler();
//        rotation.x = Math.random() * 2 * Math.PI;
//        rotation.y = Math.random() * 2 * Math.PI;
//        rotation.z = Math.random() * 2 * Math.PI;

        var scale = new THREE.Vector3();
        scale.x = Math.random() * 200 + 100;
        scale.y = Math.random() * 200 + 100;
        scale.z = Math.random() * 200 + 100;

        // give the geom's vertices a random color, to be displayed
        var geom = new THREE.CubeGeometry(1, 1, 1);
        var color = new THREE.Color(Math.random() * 0xffffff);
        applyVertexColors(geom, color);

        var cube = new THREE.Mesh(geom, defaultMaterial);
        cube.position.copy(position);
//        cube.rotation.copy(rotation);
        cube.scale.copy(scale);

        scene.add(cube);
    }

    renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
    renderer.setClearColor(0xffffff, 1);
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.sortObjects = false;

    container.appendChild(renderer.domElement);

    stats = new Stats();
    stats.domElement.style.position = 'absolute';
    stats.domElement.style.top = '0px';
    container.appendChild(stats.domElement);

    renderer.domElement.addEventListener('mousemove', onMouseMove);
}

function onMouseMove(e) {
    mouse.x = e.clientX;
    mouse.y = e.clientY;
}

function animate() {
    requestAnimationFrame(animate);

    render();
    stats.update();
}

function render() {
    controls.update();
    renderer.render(scene, camera);
}

</script>

</body>
</html>
